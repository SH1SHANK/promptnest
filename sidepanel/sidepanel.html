<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PromptNest Side Panel</title>
    <link rel="stylesheet" href="../popup/popup.css" />
    <link rel="stylesheet" href="../popup/onboarding.css" />
    <link rel="stylesheet" href="tailwind.css" />
  </head>
  <body class="pn-popup pn-sidepanel">
    <header class="pn-header pn-sidepanel-header">
      <div class="pn-header-actions">
        <button
          id="back-btn"
          class="pn-btn pn-btn--ghost pn-icon-btn hidden pn-mr-auto"
          type="button"
          title="Back to Prompts"
          aria-label="Back to Prompts"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
        </button>
        <button
          id="history-btn"
          class="pn-btn pn-btn--ghost pn-icon-btn"
          type="button"
          title="Chat History"
          aria-label="Chat History"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
        </button>
        <button
          id="settings-btn"
          class="pn-btn pn-btn--ghost pn-icon-btn"
          type="button"
          title="Settings"
          aria-label="Settings"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </button>
        <button
          id="refresh-btn"
          class="pn-btn pn-btn--ghost pn-icon-btn"
          type="button"
          title="Refresh Workspace"
          aria-label="Refresh Workspace"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 4 23 10 17 10"></polyline>
            <polyline points="1 20 1 14 7 14"></polyline>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
          </svg>
        </button>
        <button
          id="add-prompt-btn"
          class="pn-btn pn-btn--primary"
          type="button"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add Prompt
        </button>
      </div>
    </header>

    <div id="search-wrap" class="pn-search-row">
      <input
        id="prompt-search"
        class="pn-search"
        type="text"
        placeholder="Search prompts by title, text, or tags"
      />
      <span id="pn-search-spark" class="pn-search-spark pn-hidden">‚ú¶</span>
      <div id="pn-ai-bar" class="pn-ai-bar pn-ai-bar--hidden">
        <div class="pn-ai-bar__line"></div>
      </div>
    </div>

    <nav class="pn-tab-bar" aria-label="PromptNest tabs">
      <button class="tab pn-tab active" data-tab="prompts" type="button">
        Prompts
      </button>
      <button class="tab pn-tab" data-tab="tags" type="button">Tags</button>
    </nav>

    <main class="pn-main pn-sidepanel-main">
      <section class="tab-content pn-tab-content active" data-tab="prompts">
        <div id="pn-smart-strip" class="pn-smart-strip pn-hidden">
          <span class="pn-smart-strip__label">‚ú¶ Matches your current topic</span>
          <div id="pn-smart-chips" class="pn-smart-chips"></div>
          <button class="pn-smart-strip__close" id="pn-smart-close" type="button">√ó</button>
        </div>
        <div id="prompt-list" class="pn-list"></div>
      </section>

      <section class="tab-content pn-tab-content" data-tab="history">
        <div id="history-list" class="pn-list"></div>
      </section>

      <section class="tab-content pn-tab-content" data-tab="export">
        <div class="pn-export-grid">
          <aside class="pn-export-controls">
            <p id="selection-meta" class="pn-card-meta">
              No message selection received yet.
            </p>

            <label class="pn-field">
              <span>Export Format</span>
              <select id="export-format">
                <option value="markdown">Markdown (.md)</option>
                <option value="pdf">PDF (.pdf)</option>
              </select>
            </label>

            <label class="pn-check-row">
              <input id="include-date" type="checkbox" checked />
              <span>Include export date</span>
            </label>

            <label class="pn-check-row">
              <input id="include-platform" type="checkbox" checked />
              <span>Include platform label</span>
            </label>

            <button
              id="export-btn"
              type="button"
              class="pn-btn pn-btn--primary"
            >
              Export Markdown
            </button>
            <p id="export-status" class="pn-card-meta"></p>
          </aside>

          <section class="pn-export-preview-shell">
            <div class="pn-export-preview-head">
              <h3 class="pn-section-title">Preview</h3>
              <p id="preview-label" class="pn-card-meta">Markdown preview</p>
            </div>
            <div id="preview" class="pn-export-preview-body"></div>
          </section>
        </div>
      </section>

      <section class="tab-content pn-tab-content" data-tab="tags">
        <div class="pn-tags-view">
          <div id="pn-tag-filter-bar" class="pn-tag-filter-bar"></div>
          <div id="tag-list" class="pn-tag-list">
            <div id="pn-tags-empty" class="pn-empty-state">
              <div class="pn-empty-icon">üè∑Ô∏è</div>
              <p>No tags yet.</p>
              <span>Tags you add to prompts will appear here.</span>
            </div>
          </div>
        </div>
      </section>

      <section class="tab-content pn-tab-content" data-tab="settings">
        <div class="pn-sv">
          <!-- Hero -->
          <div class="pn-sv-hero">
            <h3 class="pn-sv-hero__title">Settings</h3>
            <p class="pn-sv-hero__sub">Tune intelligence, exports, and personalization.</p>
          </div>

          <!-- ‚îÄ‚îÄ Intelligence ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
          <div class="pn-sv-section">
            <h4 class="pn-sv-heading">Intelligence</h4>

            <div class="pn-sv-row">
              <div class="pn-sv-row__copy">
                <span class="pn-sv-row__label">Smart features</span>
                <span class="pn-sv-row__desc">Semantic ranking, tag suggestions, and duplicate checks.</span>
              </div>
              <label class="pn-toggle">
                <input id="setting-enable-ai" type="checkbox" checked />
                <span class="pn-toggle__track"><span class="pn-toggle__knob"></span></span>
              </label>
            </div>

            <div class="pn-sv-row">
              <div class="pn-sv-row__copy">
                <span class="pn-sv-row__label">Semantic search</span>
                <span class="pn-sv-row__desc">Rank results by meaning, not just keywords.</span>
              </div>
              <label class="pn-toggle">
                <input id="setting-semantic-search" type="checkbox" checked />
                <span class="pn-toggle__track"><span class="pn-toggle__knob"></span></span>
              </label>
            </div>

            <div class="pn-sv-model-pill" id="pn-model-pill">
              <span class="pn-sv-model-pill__dot"></span>
              <span id="ai-progress-text">Initializing‚Ä¶</span>
            </div>
          </div>

          <hr class="pn-sv-divider" />

          <!-- ‚îÄ‚îÄ Prompt Quality ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
          <div class="pn-sv-section">
            <h4 class="pn-sv-heading">Prompt Quality</h4>

            <div class="pn-sv-row">
              <div class="pn-sv-row__copy">
                <span class="pn-sv-row__label">Auto-tag suggestions</span>
                <span class="pn-sv-row__desc">Suggest tags based on prompt content.</span>
              </div>
              <label class="pn-toggle">
                <input id="setting-auto-suggest" type="checkbox" checked />
                <span class="pn-toggle__track"><span class="pn-toggle__knob"></span></span>
              </label>
            </div>

            <div class="pn-sv-row">
              <div class="pn-sv-row__copy">
                <span class="pn-sv-row__label">Duplicate detection</span>
                <span class="pn-sv-row__desc">Warn when saving near-identical prompts.</span>
              </div>
              <label class="pn-toggle">
                <input id="setting-duplicate-check" type="checkbox" checked />
                <span class="pn-toggle__track"><span class="pn-toggle__knob"></span></span>
              </label>
            </div>
          </div>

          <hr class="pn-sv-divider" />

          <!-- ‚îÄ‚îÄ Export ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
          <div class="pn-sv-section">
            <h4 class="pn-sv-heading">Export</h4>

            <label class="pn-sv-field">
              <span class="pn-sv-field__label">Default format</span>
              <select id="setting-export-format" class="pn-sv-select">
                <option value="markdown">Markdown (.md)</option>
                <option value="pdf">PDF (.pdf)</option>
              </select>
            </label>

            <div class="pn-sv-row pn-sv-row--compact">
              <span class="pn-sv-row__label">Include date</span>
              <label class="pn-toggle pn-toggle--sm">
                <input id="setting-export-date" type="checkbox" checked />
                <span class="pn-toggle__track"><span class="pn-toggle__knob"></span></span>
              </label>
            </div>

            <div class="pn-sv-row pn-sv-row--compact">
              <span class="pn-sv-row__label">Include platform</span>
              <label class="pn-toggle pn-toggle--sm">
                <input id="setting-export-platform" type="checkbox" checked />
                <span class="pn-toggle__track"><span class="pn-toggle__knob"></span></span>
              </label>
            </div>
          </div>

          <hr class="pn-sv-divider" />

          <!-- ‚îÄ‚îÄ Connections ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
          <div class="pn-sv-section">
            <h4 class="pn-sv-heading">Connections</h4>

            <div class="pn-sv-api-row">
              <div class="pn-sv-api-row__icon">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              </div>
              <input
                id="setting-gemini-key"
                type="password"
                class="pn-sv-api-row__input"
                placeholder="Gemini API key"
                autocomplete="off"
              />
              <button type="button" id="check-api-key" class="pn-sv-api-row__check" title="Test connection">Check</button>
              <button type="button" id="toggle-key-vis" class="pn-sv-api-row__eye" title="Show/hide key">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
              </button>
            </div>
            <p class="pn-sv-api-hint">
              Powers contextual suggestions.
              <a href="https://aistudio.google.com/app/apikey" target="_blank" class="pn-sv-api-link">Get a free key ‚Üí</a>
            </p>
          </div>

          <hr class="pn-sv-divider" />

          <!-- ‚îÄ‚îÄ Personalization ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
          <div class="pn-sv-section">
            <h4 class="pn-sv-heading">Personalization</h4>

            <label class="pn-sv-field">
              <span class="pn-sv-field__label">Your context</span>
              <textarea
                id="setting-user-context"
                class="pn-sv-textarea"
                rows="3"
                placeholder="e.g. I build TypeScript browser extensions and write technical docs."
              ></textarea>
            </label>
            <p class="pn-sv-api-hint">Helps smart features understand your workflow.</p>
          </div>

          <!-- ‚îÄ‚îÄ Actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
          <div class="pn-sv-actions">
            <button id="reset-settings-btn" class="pn-btn pn-btn--ghost" type="button">Reset</button>
            <div class="pn-sv-actions__right">
              <p id="settings-status" class="pn-sv-status"></p>
              <button id="save-settings-btn" class="pn-btn pn-btn--primary" type="button" disabled>Save</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <div id="add-modal" class="pn-modal pn-hidden">
      <div class="pn-modal__backdrop" data-close-modal></div>
      <div class="pn-modal__panel">
        <h2 class="pn-modal__title">Save Prompt</h2>

        <label class="pn-field">
          <span>Title</span>
          <input id="prompt-title" type="text" placeholder="Prompt title" />
        </label>

        <label class="pn-field">
          <span>Prompt Text</span>
          <textarea
            id="prompt-text"
            rows="6"
            placeholder="Write your prompt here..."
          ></textarea>
        </label>

        <label class="pn-field">
          <span>Tags</span>
          <div class="pn-tag-badges" id="tag-badges-wrap">
            <input
              id="prompt-tags-input"
              class="pn-tag-badges__input"
              type="text"
              placeholder="Type a tag and press Space"
            />
          </div>
          <input id="prompt-tags" type="hidden" />
        </label>

        <div id="pn-tag-suggestions" class="pn-tag-suggestions"></div>

        <div id="pn-duplicate-warning" class="pn-duplicate-warning pn-hidden"></div>

        <div class="pn-modal__actions">
          <button id="cancel-modal" class="pn-btn pn-btn--ghost" type="button">
            Cancel
          </button>
          <button
            id="confirm-duplicate"
            class="pn-btn pn-btn-warn hidden"
            type="button"
          >
            Save Anyway
          </button>
          <button
            id="save-new-prompt"
            class="pn-btn pn-btn--primary"
            type="button"
          >
            Save
          </button>
        </div>
      </div>
    </div>

    <script src="../libs/jspdf.min.js"></script>
    <script src="../libs/html2pdf.bundle.min.js"></script>
    <script src="../libs/turndown.js"></script>
    <script src="../libs/markdown-it.min.js"></script>
    <script src="../utils/storage.js"></script>
    <script src="../utils/exporter.js"></script>
    <script src="../utils/ai.js"></script>
    <script src="../utils/ai-bridge.js"></script>
    <script src="sidepanel.js"></script>
  </body>
</html>
